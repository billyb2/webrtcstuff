 
<!DOCTYPE html>
<html>
<head>
<title>Page Title</title>
</head>
<body>

<p id="id"></p>
<p id="debug"></p>
<p id="serverData"></p>
<input id="terminal"></input>
<canvas id="canvas">

<script src="https://unpkg.com/peerjs@1.0.0/dist/peerjs.min.js"></script>


<script>
//Canvas stuff
var c=document.getElementById("canvas");
var ctx=c.getContext("2d");
ctx.canvas.width = 200;
ctx.canvas.height = 200;

var debug = document.getElementById("debug");
var peer = new Peer("wowzerz");
var server = prompt("Server? T or F").toUpperCase();
var keys = [];
document.body.addEventListener("keydown", function(e) {
    keys[e.keyCode] = true;
});
document.body.addEventListener("keyup", function(e) {
    keys[e.keyCode] = false;
});
//Sets up servers or connections
if(server == "T"){

//I know this would be easier to manage with objects, but I'm exhausted
var players = [];
var playersData = [];


//https://stackoverflow.com/questions/4587061/how-to-determine-if-object-is-in-array
function containsObject(obj, list) {
    var i;
    for (i = 0; i < list.length; i++) {
        if (list[i] === obj) {
            return true;
        }
    }

    return false;
}


//Just shows id on connection open
peer.on("open", function(id){document.getElementById("id").innerHTML = id;} );


var terminal = document.getElementById("terminal");
terminal.type = "";

peer.on('connection', function(conn) { 

	//Creates a list of players, ids, and coordinates
	players.push(conn.metadata);
    
    
	conn.on('open', function() {
    
    	//If data is received...
  		conn.on('data', function(data) {

        	
        	/**
				Clears the screen
                gotta make it so it checks that it draws every player, somehow
            **/
            
            ctx.fillStyle = "white";
            ctx.fillRect(0, 0, ctx.canvas.width, ctx.canvas.height);
			ctx.fillStyle = data.color;
            ctx.fillRect(data.playerX, data.playerY, 20, 20);
            

            
  		});
        
        	setInterval(function(){
        		if(keys[13]){
					if(terminal.value == "list"){

                    	//Loop through array and list all users
                        debug.innerHTML = "";
                    	for(var i = 0; i < players.length; i++){
                            debug.innerHTML+="<br>"+players[i].username;
                        }
                    }
					terminal.value = "";

                    
         	    }
           }, 100);
           
	});
});


function removePlayer(identifierType, identifier){
	var playerIndexToRemove;
	if(identifierType == "username"){
        for(var i = 0; i <= players.length; i++){
        	if(players[i].username == identifier){
    			playerIndexToRemove = i;
                break;
            }
    	}
    
    }
    players.splice(playerIndexToRemove, 1);
    alert(players);
}

peer.on('disconnected', function(conn){
	//Find the player that disconnected, and remove them from the list
	players.pop();
    alert(players);
});

                    peer.on('error', function (err) {
                        console.log(err);
                        alert('' + err);
                    });
} else {
	//Code for the random color stolen from another pror
	function getRandomColor() {
 		var letters = '0123456789ABCDEF';
 		var color = '#';
        
  		for (var i = 0; i < 6; i++) {
    		color += letters[Math.floor(Math.random() * 16)];
  		}
        
  		return color;
		}

    var username = prompt("Username?");
	var information = {
		color: getRandomColor(),
        playerX: 100,
        playerY: 100,
        username: username
    }

	var conn = peer.connect(prompt("Server ID?"), {
    	reliable:false,
        label: username,
        metadata: {
            username: username
        }
    });
    
	conn.on('open', loop);
    
    function loop(){
    	if(keys[37]){
        	information.playerX -= 2;
        }
        
        if(keys[39]){
        	information.playerX -= 2;
        }
    
    
    	conn.send(information);
    	requestAnimationFrame(loop);
    }
      

}
</script>

</body>
</html>
